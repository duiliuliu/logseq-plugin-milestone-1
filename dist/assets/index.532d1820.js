import{h as M,r as d,j as u,F as w,a as t,B as f,S as I,A,b,D as L,c as N,T as y,C as T,d as B,e as E,R as F,f as $}from"./vendor.87498e14.js";const R=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}};R();const z=o=>{const e=o?.match(/\[\[(.+?)\]\]/g)?.slice(-1)[0];return M(e?.replaceAll(/^(\[\[)|(\]\])$/g,""),Y()?.dateFormatter)},U=o=>{const e=o?.match(/\[\[(.+?)\]\]/g)?.slice(-1)[0];return v(e?o.replace(e,"").trim():o)},v=o=>{const e=/(?<!!)\[(.*?)\]\((.*?)\)/ig;return"<p>"+o.replace(e,"<a href=$2>$1</a>")+"</p>"},j=o=>o?.children?.find(r=>r?.content==="milestones")?.children?.map(r=>{const l=r?.content;return{content:U(l),date:z(l)}}),P=async(o,e)=>logseq.Editor.getBlock(o,e),Y=()=>logseq.settings,V=({uuid:o,forceUpdate:e})=>{const[r,l]=d.exports.useState(),[s,n]=d.exports.useState(!0),[a,C]=d.exports.useState(!1),[p,k]=d.exports.useState(!0);d.exports.useEffect(()=>{(async()=>{const m=await P(o,{includeChildren:!0}),i=j(m);l(i)})()},[o,e]);const q=()=>{n(!s)},h=c=>{C(c)},S=()=>{k(!p)},x=c=>r?.filter(i=>i.date.isSame(c,"day"))?.map((i,O)=>{const D=i.date.isBefore(M(),"day");return t(E,{title:i.content,arrowPointAtCenter:!0,children:t("div",{className:`whitespace-nowrap bg-blue-200 rounded-sm mb-1 ${D?"opacity-50":""}`,children:i.content},i.date.valueOf()+O)})});return u(w,{children:[t("div",{className:"w-screen h-screen absolute bg-transparent",onClick:()=>logseq.hideMainUI()}),u("div",{className:`${a?"w-2/3":"w-1/3"} h-5/6 bg-white absolute top-12 right-4 shadow-lg p-1 overflow-auto rounded transition-all`,children:[t("div",{className:"absolute left-4 top-4",children:a?t(f,{shape:"circle",icon:t(I,{}),onClick:()=>h(!1)}):t(f,{shape:"circle",icon:t(A,{}),onClick:()=>h(!0)})}),u("div",{className:"p-4",children:[t("div",{className:"absolute left-14 top-4",children:t(f,{shape:"circle",icon:s?t(b,{}):t(b,{}),onClick:q})}),t("br",{}),t("div",{className:"absolute left-24 top-4",children:t(f,{shape:"circle",icon:p?t(L,{}):t(N,{}),onClick:S})}),t("br",{}),s?t(w,{children:t(y,{mode:p?"left":"alternate",children:r?.map((c,m)=>u(y.Item,{dot:t(T,{style:{fontSize:"16px"}}),label:c.date.format("YYYY-MM-DD"),children:[" ",t("div",{dangerouslySetInnerHTML:{__html:c.content}})]}))})}):t(B,{dateCellRender:x})]})]})]})};let g=new Map;console.log("[faiz:] === logseq-plugin-milestone loaded"),logseq.ready(()=>{logseq.Editor.registerSlashCommand("milestone",async()=>{const o=await logseq.Editor.getCurrentBlock();!o?.uuid||logseq.Editor.insertAtEditingCursor(`{{renderer milestone-${o.uuid}}}`)}),logseq.setMainUIInlineStyle({position:"fixed",zIndex:11}),logseq.provideModel({show(o){const e=o?.dataset?.faizUuid;W(e,g.get(e)||0),logseq.showMainUI()}}),logseq.App.onMacroRendererSlotted(async({slot:o,payload:e})=>{const r=g.get(e.uuid);if(g.set(e.uuid,r?r+1:1),!/^milestone/.test(e?.arguments?.[0]))return"milestone parse error";logseq.provideUI({key:"milestone",slot:o,reset:!0,template:`<a style="color: var(--ls-link-ref-text-color);" data-on-click="show" data-faiz-uuid="${e?.uuid}">show calender view</a>`})})});function W(o,e){F.render(t($.StrictMode,{children:t(V,{uuid:o,forceUpdate:e})}),document.getElementById("root"))}
