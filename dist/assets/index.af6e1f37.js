import{h,r as u,j as m,F as q,a as n,B as f,S as w,A as v,C as N,T as E,R as x,b as A}from"./vendor.9aab52af.js";const F=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}};F();const S=t=>{const e=t?.match(/\[\[(.+?)\]\]/g)?.slice(-1)[0];return h(e?.replaceAll(/^(\[\[)|(\]\])$/g,""),O()?.dateFormatter)},D=t=>{const e=t?.match(/\[\[(.+?)\]\]/g)?.slice(-1)[0];return e?t.replace(e,"").trim():t},I=t=>t?.children?.find(r=>r?.content==="milestones")?.children?.map(r=>{const l=r?.content;return{content:D(l),date:S(l)}}),B=async(t,e)=>logseq.Editor.getBlock(t,e),O=()=>logseq.settings,T=({uuid:t,forceUpdate:e})=>{const[r,l]=u.exports.useState(),[s,o]=u.exports.useState(!0),[a,M]=u.exports.useState(!1);u.exports.useEffect(()=>{(async()=>{const d=await B(t,{includeChildren:!0}),i=I(d);l(i)})()},[t,e]);const y=()=>{o(!s)},b=c=>r?.filter(i=>i.date.isSame(c,"day"))?.map((i,C)=>{const k=i.date.isBefore(h(),"day");return n(E,{title:i.content,arrowPointAtCenter:!0,children:n("div",{className:`whitespace-nowrap bg-blue-200 rounded-sm mb-1 ${k?"opacity-50":""}`,children:i.content},i.date.valueOf()+C)})}),p=c=>{M(c)};return m(q,{children:[n("div",{className:"w-screen h-screen absolute bg-transparent",onClick:()=>logseq.hideMainUI()}),m("div",{className:`${a?"w-2/3":"w-1/3"} h-5/6 bg-white absolute top-12 right-4 shadow-lg p-1 overflow-auto rounded transition-all`,children:[n("div",{className:"absolute left-4 top-4",children:a?n(f,{shape:"circle",icon:n(w,{}),onClick:()=>p(!1)}):n(f,{shape:"circle",icon:n(v,{}),onClick:()=>p(!0)})}),m("div",{className:"p-4",children:[n("div",{className:"flex justify-between items-center mb-4",children:n(f,{shape:"circle",icon:s?n(w,{}):n(v,{}),onClick:y,children:s?"\u8FD4\u56DE\u65E5\u5386\u89C6\u56FE":"\u663E\u793A\u65F6\u95F4\u8F74"})}),s?n("div",{className:"timeline-view",children:r?.map((c,d)=>m("div",{className:"milestone-item",children:[n("div",{className:"date",children:c.date.format("YYYY-MM-DD")}),n("div",{className:"content",children:c.content})]},d))}):n(N,{dateCellRender:b})]})]})]})};let g=new Map;console.log("[faiz:] === logseq-plugin-milestone loaded"),logseq.ready(()=>{logseq.Editor.registerSlashCommand("milestone",async()=>{const t=await logseq.Editor.getCurrentBlock();!t?.uuid||logseq.Editor.insertAtEditingCursor(`{{renderer milestone-${t.uuid}}}`)}),logseq.setMainUIInlineStyle({position:"fixed",zIndex:11}),logseq.provideModel({show(t){const e=t?.dataset?.faizUuid;j(e,g.get(e)||0),logseq.showMainUI()}}),logseq.App.onMacroRendererSlotted(async({slot:t,payload:e})=>{const r=g.get(e.uuid);if(g.set(e.uuid,r?r+1:1),!/^milestone/.test(e?.arguments?.[0]))return"milestone parse error";logseq.provideUI({key:"milestone",slot:t,reset:!0,template:`<a style="color: var(--ls-link-ref-text-color);" data-on-click="show" data-faiz-uuid="${e?.uuid}">show calender view</a>`})})});function j(t,e){x.render(n(A.StrictMode,{children:n(T,{uuid:t,forceUpdate:e})}),document.getElementById("root"))}
