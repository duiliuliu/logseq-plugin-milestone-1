import{h,r as d,j as m,F as q,a as s,B as f,S as x,A as S,b as w,T as M,C as A,c as I,R as N,d as O}from"./vendor.ee077195.js";const B=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}};B();const E=t=>{const e=t?.match(/\[\[(.+?)\]\]/g)?.slice(-1)[0];return h(e?.replaceAll(/^(\[\[)|(\]\])$/g,""),L()?.dateFormatter)},T=t=>{const e=t?.match(/\[\[(.+?)\]\]/g)?.slice(-1)[0];return e?t.replace(e,"").trim():t},D=t=>t?.children?.find(r=>r?.content==="milestones")?.children?.map(r=>{const l=r?.content;return{content:T(l),date:E(l)}}),F=async(t,e)=>logseq.Editor.getBlock(t,e),L=()=>logseq.settings,R=({uuid:t,forceUpdate:e})=>{const[r,l]=d.exports.useState(),[o,n]=d.exports.useState(!0),[a,y]=d.exports.useState(!1);d.exports.useEffect(()=>{(async()=>{const u=await F(t,{includeChildren:!0}),i=D(u);l(i)})()},[t,e]);const b=()=>{n(!o)},v=c=>r?.filter(i=>i.date.isSame(c,"day"))?.map((i,C)=>{const k=i.date.isBefore(h(),"day");return s(I,{title:i.content,arrowPointAtCenter:!0,children:s("div",{className:`whitespace-nowrap bg-blue-200 rounded-sm mb-1 ${k?"opacity-50":""}`,children:i.content},i.date.valueOf()+C)})}),p=c=>{y(c)};return m(q,{children:[s("div",{className:"w-screen h-screen absolute bg-transparent",onClick:()=>logseq.hideMainUI()}),m("div",{className:`${a?"w-2/3":"w-1/3"} h-5/6 bg-white absolute top-12 right-4 shadow-lg p-1 overflow-auto rounded transition-all`,children:[s("div",{className:"absolute left-4 top-4",children:a?s(f,{shape:"circle",icon:s(x,{}),onClick:()=>p(!1)}):s(f,{shape:"circle",icon:s(S,{}),onClick:()=>p(!0)})}),m("div",{className:"p-4",children:[s("div",{className:"absolute left-14 top-4",children:s(f,{shape:"circle",icon:o?s(w,{}):s(w,{}),onClick:b})}),s("br",{}),s("br",{}),o?s(M,{mode:"right",children:r?.map((c,u)=>s(M.Item,{label:c.date.format("YYYY-MM-DD"),children:c.content}))}):s(A,{dateCellRender:v})]})]})]})};let g=new Map;console.log("[faiz:] === logseq-plugin-milestone loaded"),logseq.ready(()=>{logseq.Editor.registerSlashCommand("milestone",async()=>{const t=await logseq.Editor.getCurrentBlock();!t?.uuid||logseq.Editor.insertAtEditingCursor(`{{renderer milestone-${t.uuid}}}`)}),logseq.setMainUIInlineStyle({position:"fixed",zIndex:11}),logseq.provideModel({show(t){const e=t?.dataset?.faizUuid;U(e,g.get(e)||0),logseq.showMainUI()}}),logseq.App.onMacroRendererSlotted(async({slot:t,payload:e})=>{const r=g.get(e.uuid);if(g.set(e.uuid,r?r+1:1),!/^milestone/.test(e?.arguments?.[0]))return"milestone parse error";logseq.provideUI({key:"milestone",slot:t,reset:!0,template:`<a style="color: var(--ls-link-ref-text-color);" data-on-click="show" data-faiz-uuid="${e?.uuid}">show calender view</a>`})})});function U(t,e){N.render(s(O.StrictMode,{children:s(R,{uuid:t,forceUpdate:e})}),document.getElementById("root"))}
