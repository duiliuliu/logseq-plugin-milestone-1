import{h as f,r as u,j as g,a as s,B as y,S as w,A as v,C as M,T as C,R as q,b as E}from"./vendor.82a197de.js";const b=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}};b();const k=t=>{const e=t?.match(/\[\[(.+?)\]\]/g)?.slice(-1)[0];return f(e?.replaceAll(/^(\[\[)|(\]\])$/g,""),S()?.dateFormatter)},A=t=>{const e=t?.match(/\[\[(.+?)\]\]/g)?.slice(-1)[0];return e?t.replace(e,"").trim():t},x=t=>t?.children?.find(r=>r?.content==="milestones")?.children?.map(r=>{const l=r?.content;return{content:A(l),date:k(l)}}),N=async(t,e)=>logseq.Editor.getBlock(t,e),S=()=>logseq.settings,D=({uuid:t,forceUpdate:e})=>{const[r,l]=u.exports.useState(),[n,o]=u.exports.useState(!1);return u.exports.useEffect(()=>{(async()=>{const d=await N(t,{includeChildren:!0}),i=x(d);l(i)})()},[t,e]),g("div",{className:"p-4",children:[s("div",{className:"flex justify-between items-center mb-4",children:s(y,{shape:"circle",icon:n?s(w,{}):s(v,{}),onClick:()=>{o(!n)},children:n?"\u8FD4\u56DE\u65E5\u5386\u89C6\u56FE":"\u663E\u793A\u65F6\u95F4\u8F74"})}),n?s("div",{className:"timeline-view",children:r?.map((c,d)=>g("div",{className:"milestone-item",children:[s("div",{className:"date",children:c.date.format("YYYY-MM-DD")}),s("div",{className:"content",children:c.content})]},d))}):s(M,{dateCellRender:c=>r?.filter(i=>i.date.isSame(c,"day"))?.map((i,p)=>{const h=i.date.isBefore(f(),"day");return s(C,{title:i.content,arrowPointAtCenter:!0,children:s("div",{className:`whitespace-nowrap bg-blue-200 rounded-sm mb-1 ${h?"opacity-50":""}`,children:i.content},i.date.valueOf()+p)})})})]})};let m=new Map;console.log("[faiz:] === logseq-plugin-milestone loaded"),logseq.ready(()=>{logseq.Editor.registerSlashCommand("milestone",async()=>{const t=await logseq.Editor.getCurrentBlock();!t?.uuid||logseq.Editor.insertAtEditingCursor(`{{renderer milestone-${t.uuid}}}`)}),logseq.setMainUIInlineStyle({position:"fixed",zIndex:11}),logseq.provideModel({show(t){const e=t?.dataset?.faizUuid;F(e,m.get(e)||0),logseq.showMainUI()}}),logseq.App.onMacroRendererSlotted(async({slot:t,payload:e})=>{const r=m.get(e.uuid);if(m.set(e.uuid,r?r+1:1),!/^milestone/.test(e?.arguments?.[0]))return"milestone parse error";logseq.provideUI({key:"milestone",slot:t,reset:!0,template:`<a style="color: var(--ls-link-ref-text-color);" data-on-click="show" data-faiz-uuid="${e?.uuid}">show calender view</a>`})})});function F(t,e){q.render(s(E.StrictMode,{children:s(D,{uuid:t,forceUpdate:e})}),document.getElementById("root"))}
